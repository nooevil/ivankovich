#!/usr/bin/env node
var child_process=require("child_process");function postNpmInstall(){Promise.all([exec("git show ORIG_HEAD:package.json"),exec("git show HEAD:package.json")]).then(e=>{const s=JSON.parse(e[0]),c=JSON.parse(e[1]);(haveObjectValuesChanged(s.dependencies,c.dependencies)||haveObjectValuesChanged(s.devDependencies,c.devDependencies))&&(child_process.execSync("npm install",{stdio:["pipe","pipe",process.stderr]}),console.log("Please restart the server."))},e=>{const s=/^fatal: Invalid object name/;if(!s.test(e))throw new Error(s)}).then(()=>process.exit(0),e=>{console.error(e),process.exit(1)})}const exec=(e,s)=>new Promise((c,t)=>{child_process.exec(e,Object(s),(e,s,o)=>{e?t(o):c(s)})}),haveObjectValuesChanged=(e,s)=>Object.keys(Object(e)).concat(Object.keys(Object(s))).some(c=>e[c]!==s[c]);module.exports=postNpmInstall;
